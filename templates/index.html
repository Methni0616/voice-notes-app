<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">

  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/static/service-worker.js");
}
</script>
</head>
<body>

<div class="container">
  <div class="top-bar">
    <h2>ðŸŽ¤ Voice Notes</h2>
    <button class="toggle" onclick="toggleDarkMode()">ðŸŒ™</button>
  </div>

  <button class="btn record" onclick="startRecording()">ðŸŽ™ Start Recording</button>
  <button class="btn save" onclick="saveNote()">ðŸ’¾ Save Note</button>

  <div id="output" class="note-preview">Your voice text will appear here...</div>

  <h3>ðŸ“’ Saved Notes</h3>
  <ul id="notes" class="notes-list"></ul>
</div>

<script>
  let transcript = "";

  function startRecording() {
    // ðŸ“³ Vibration feedback
    if (navigator.vibrate) {
      navigator.vibrate(200);
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.start();

    recognition.onresult = function(event) {
      transcript = event.results[0][0].transcript;
      document.getElementById("output").innerText = transcript;
    };
  }

  function saveNote() {
    if (!transcript) return;

    fetch("/save_note", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ note: transcript })
    }).then(() => {
      transcript = "";
      document.getElementById("output").innerText = "Saved!";
      loadNotes();
    });
  }

  function deleteNote(index) {
    fetch(`/delete_note/${index}`, { method: "DELETE" })
      .then(() => loadNotes());
  }

  function shareNote(note) {
    const url = `https://wa.me/?text=${encodeURIComponent(note)}`;
    window.open(url, "_blank");
  }

  function loadNotes() {
    fetch("/get_notes")
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("notes");
        list.innerHTML = "";

        data.forEach((note, index) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${note}</span>
            <div class="actions">
              <button onclick="shareNote('${note}')">ðŸ“¤</button>
              <button onclick="deleteNote(${index})">ðŸ—‘</button>
            </div>
          `;
          list.appendChild(li);
        });
      });
  }

  function toggleDarkMode() {
    document.body.classList.toggle("dark");
  }

  loadNotes();
</script>

</body>
</html>
